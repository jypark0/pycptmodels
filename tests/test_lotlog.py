import numpy as np

from pycptmodels.erm import LotERM
from pycptmodels.input import PoissonProcessInput


def test_train(flowline):
    input1 = PoissonProcessInput(N=200, lambda_=1500, lotsizes=[3, 4, 5, 6, 7],
                                 lotsize_weights=[0.05, 0.2, 0.5, 0.2, 0.05], reticle=[250, 250], prescan=[400, 400],
                                 K=3)
    input1.initialize()
    input1.A = [0, 3100, 3600, 6300, 6300, 6500, 6800, 6900, 7500, 8600, 13000, 13900, 14500, 16800, 17100, 17300,
                19900, 24100, 25100, 25200, 31000, 33300, 33600, 33900, 37000, 37100, 37600, 38100, 39900, 40700, 44300,
                44400, 45100, 46500, 46700, 47800, 49200, 50800, 51500, 51500, 51800, 52400, 53200, 53700, 54000, 54800,
                57600, 58100, 61500, 69400, 70600, 71300, 74200, 74500, 74600, 75600, 75700, 76400, 80000, 81600, 82500,
                82500, 82800, 83900, 85000, 86800, 87400, 87400, 87500, 89300, 89800, 91700, 92500, 92900, 94700, 95000,
                96800, 98800, 99600, 101800, 106700, 107900, 111100, 112500, 113800, 114000, 115000, 115200, 115500,
                117600, 124500, 125800, 126600, 127100, 127500, 131800, 133800, 135700, 136300, 137500, 141000, 141000,
                145400, 147300, 148700, 149500, 150700, 153000, 161100, 167600, 169700, 176700, 176900, 178600, 181400,
                181600, 184400, 187200, 188300, 188400, 188400, 198500, 200400, 200800, 205400, 207300, 209200, 210100,
                211100, 217400, 217800, 217800, 218000, 219100, 220000, 220600, 221700, 229800, 230400, 231800, 231800,
                232200, 232800, 236700, 237100, 238600, 241100, 241600, 243700, 244900, 245600, 247800, 249700, 250800,
                254900, 255700, 260500, 260600, 264300, 266900, 268500, 270900, 271000, 271100, 272900, 274600, 283600,
                285600, 290000, 291100, 291700, 292400, 292800, 294800, 296400, 297700, 298300, 298700, 301700, 301900,
                302300, 303100, 305600, 306200, 307600, 308000, 312100, 312300, 313000, 315900, 316300, 316700, 317500,
                318300, 321500, 322200, 323000, 325500, 328100, 328400]
    input1.W = [5, 6, 5, 5, 5, 5, 3, 5, 4, 5, 3, 6, 5, 6, 3, 6, 4, 3, 5, 5, 5, 5, 6, 5, 7, 6, 5, 5, 7, 7, 4, 4, 5, 3, 5,
                3, 5, 4, 6, 5, 4, 6, 5, 6, 4, 6, 5, 4, 4, 3, 6, 6, 6, 5, 5, 4, 5, 4, 6, 7, 5, 5, 5, 4, 5, 6, 6, 5, 7, 5,
                5, 5, 5, 6, 4, 6, 5, 5, 4, 6, 5, 5, 6, 6, 4, 6, 6, 3, 5, 4, 5, 4, 4, 6, 6, 4, 4, 6, 5, 3, 6, 5, 5, 5, 5,
                5, 5, 7, 5, 5, 5, 4, 4, 5, 5, 6, 5, 5, 6, 4, 5, 4, 4, 4, 5, 4, 5, 5, 6, 5, 6, 5, 5, 4, 6, 5, 6, 6, 5, 5,
                6, 5, 5, 5, 5, 5, 7, 5, 6, 5, 4, 5, 6, 4, 6, 4, 4, 3, 4, 5, 5, 6, 6, 4, 5, 4, 3, 6, 5, 4, 6, 5, 5, 5, 4,
                4, 4, 4, 6, 5, 5, 6, 6, 5, 4, 5, 6, 5, 5, 5, 6, 5, 4, 4, 5, 5, 5, 5, 3, 6]
    input1.lotclass = [1, 0, 0, 0, 0, 0, 2, 1, 2, 2, 2, 1, 0, 0, 0, 0, 0, 1, 1, 2, 0, 2, 1, 1, 1, 0, 0, 1, 2, 2, 1, 1,
                       1, 2, 2, 0, 0, 2, 2, 0, 0, 2, 0, 0, 2, 2, 0, 0, 2, 0, 2, 2, 2, 1, 1, 0, 1, 2, 1, 0, 1, 0, 1, 0,
                       0, 0, 0, 0, 0, 1, 0, 1, 1, 2, 2, 2, 0, 0, 0, 0, 1, 1, 0, 2, 0, 1, 2, 2, 0, 0, 0, 1, 0, 2, 2, 2,
                       0, 2, 0, 2, 2, 0, 0, 1, 1, 1, 1, 2, 2, 0, 0, 2, 1, 0, 1, 0, 1, 1, 2, 2, 2, 0, 1, 0, 0, 2, 2, 2,
                       0, 1, 2, 0, 0, 2, 2, 1, 1, 2, 0, 1, 0, 2, 0, 2, 2, 2, 0, 1, 2, 1, 2, 1, 0, 0, 2, 0, 2, 2, 2, 0,
                       0, 0, 0, 0, 0, 0, 0, 2, 2, 2, 1, 2, 1, 2, 1, 2, 1, 2, 2, 1, 0, 0, 1, 2, 2, 1, 1, 0, 2, 2, 2, 2,
                       2, 1, 0, 0, 0, 1, 0, 0]

    FL = flowline
    FL.initialize()
    FL.run(input1)

    erm = LotERM()
    erm.train(input1, FL.L, FL.S, FL.C, FL.R)

    assert np.array_equal(erm.phi1,
                          [1, 17, 20, 21, 30, 37, 48, 49, 52, 79, 80, 82, 90, 95, 96, 97, 100, 102, 103, 107, 108, 109,
                           111, 114, 117, 121, 122, 124, 125, 129, 137, 154, 156, 158, 159, 161, 166, 167, 168, 186,
                           194, 197, 198])
    assert np.allclose(erm.A1, [110., 110., 110.])
    assert np.allclose(erm.B1, [1483., 1483., 1653.])

    assert np.array_equal(erm.phi2,
                          [4, 9, 23, 26, 29, 31, 34, 40, 43, 45, 47, 54, 64, 65, 67, 68, 72, 74, 87, 89, 94, 119, 120,
                           132, 134, 136, 144, 157, 181, 199])
    assert np.allclose(erm.A2, [110., 110., 110.])
    assert np.allclose(erm.B2, [360., 360., 360.])

    assert np.allclose(erm.Dm, [2258.230769, 2033.4, 2021])
    assert np.allclose(erm.Dp, [2258.230769, 2033.4, 2021])

    assert np.allclose(erm.E, [[1235.973684, 1640.473684, 2608.571429], [2229.368421, 908.7857143, 1330.529412],
                               [2170.55, 1624.666667, 952.375]])


def test_run(flowline):
    input1 = PoissonProcessInput(N=200, lambda_=1500, lotsizes=[3, 4, 5, 6, 7],
                                 lotsize_weights=[0.05, 0.2, 0.5, 0.2, 0.05], reticle=[250, 250], prescan=[400, 400],
                                 K=3)
    input1.initialize()
    input1.A = [0, 3100, 3600, 6300, 6300, 6500, 6800, 6900, 7500, 8600, 13000, 13900, 14500, 16800, 17100, 17300,
                19900, 24100, 25100, 25200, 31000, 33300, 33600, 33900, 37000, 37100, 37600, 38100, 39900, 40700, 44300,
                44400, 45100, 46500, 46700, 47800, 49200, 50800, 51500, 51500, 51800, 52400, 53200, 53700, 54000, 54800,
                57600, 58100, 61500, 69400, 70600, 71300, 74200, 74500, 74600, 75600, 75700, 76400, 80000, 81600, 82500,
                82500, 82800, 83900, 85000, 86800, 87400, 87400, 87500, 89300, 89800, 91700, 92500, 92900, 94700, 95000,
                96800, 98800, 99600, 101800, 106700, 107900, 111100, 112500, 113800, 114000, 115000, 115200, 115500,
                117600, 124500, 125800, 126600, 127100, 127500, 131800, 133800, 135700, 136300, 137500, 141000, 141000,
                145400, 147300, 148700, 149500, 150700, 153000, 161100, 167600, 169700, 176700, 176900, 178600, 181400,
                181600, 184400, 187200, 188300, 188400, 188400, 198500, 200400, 200800, 205400, 207300, 209200, 210100,
                211100, 217400, 217800, 217800, 218000, 219100, 220000, 220600, 221700, 229800, 230400, 231800, 231800,
                232200, 232800, 236700, 237100, 238600, 241100, 241600, 243700, 244900, 245600, 247800, 249700, 250800,
                254900, 255700, 260500, 260600, 264300, 266900, 268500, 270900, 271000, 271100, 272900, 274600, 283600,
                285600, 290000, 291100, 291700, 292400, 292800, 294800, 296400, 297700, 298300, 298700, 301700, 301900,
                302300, 303100, 305600, 306200, 307600, 308000, 312100, 312300, 313000, 315900, 316300, 316700, 317500,
                318300, 321500, 322200, 323000, 325500, 328100, 328400]
    input1.W = [5, 6, 5, 5, 5, 5, 3, 5, 4, 5, 3, 6, 5, 6, 3, 6, 4, 3, 5, 5, 5, 5, 6, 5, 7, 6, 5, 5, 7, 7, 4, 4, 5, 3, 5,
                3, 5, 4, 6, 5, 4, 6, 5, 6, 4, 6, 5, 4, 4, 3, 6, 6, 6, 5, 5, 4, 5, 4, 6, 7, 5, 5, 5, 4, 5, 6, 6, 5, 7, 5,
                5, 5, 5, 6, 4, 6, 5, 5, 4, 6, 5, 5, 6, 6, 4, 6, 6, 3, 5, 4, 5, 4, 4, 6, 6, 4, 4, 6, 5, 3, 6, 5, 5, 5, 5,
                5, 5, 7, 5, 5, 5, 4, 4, 5, 5, 6, 5, 5, 6, 4, 5, 4, 4, 4, 5, 4, 5, 5, 6, 5, 6, 5, 5, 4, 6, 5, 6, 6, 5, 5,
                6, 5, 5, 5, 5, 5, 7, 5, 6, 5, 4, 5, 6, 4, 6, 4, 4, 3, 4, 5, 5, 6, 6, 4, 5, 4, 3, 6, 5, 4, 6, 5, 5, 5, 4,
                4, 4, 4, 6, 5, 5, 6, 6, 5, 4, 5, 6, 5, 5, 5, 6, 5, 4, 4, 5, 5, 5, 5, 3, 6]
    input1.lotclass = [1, 0, 0, 0, 0, 0, 2, 1, 2, 2, 2, 1, 0, 0, 0, 0, 0, 1, 1, 2, 0, 2, 1, 1, 1, 0, 0, 1, 2, 2, 1, 1,
                       1, 2, 2, 0, 0, 2, 2, 0, 0, 2, 0, 0, 2, 2, 0, 0, 2, 0, 2, 2, 2, 1, 1, 0, 1, 2, 1, 0, 1, 0, 1, 0,
                       0, 0, 0, 0, 0, 1, 0, 1, 1, 2, 2, 2, 0, 0, 0, 0, 1, 1, 0, 2, 0, 1, 2, 2, 0, 0, 0, 1, 0, 2, 2, 2,
                       0, 2, 0, 2, 2, 0, 0, 1, 1, 1, 1, 2, 2, 0, 0, 2, 1, 0, 1, 0, 1, 1, 2, 2, 2, 0, 1, 0, 0, 2, 2, 2,
                       0, 1, 2, 0, 0, 2, 2, 1, 1, 2, 0, 1, 0, 2, 0, 2, 2, 2, 0, 1, 2, 1, 2, 1, 0, 0, 2, 0, 2, 2, 2, 0,
                       0, 0, 0, 0, 0, 0, 0, 2, 2, 2, 1, 2, 1, 2, 1, 2, 1, 2, 2, 1, 0, 0, 1, 2, 2, 1, 1, 0, 2, 2, 2, 2,
                       2, 1, 0, 0, 0, 1, 0, 0]

    FL = flowline
    FL.initialize()
    FL.run(input1)

    erm = LotERM()
    erm.train(input1, FL.L, FL.S, FL.C, FL.R)
    erm.run(input1)

    assert np.allclose(erm.V,
                       [-110.40, 4515.24, 5415.99, 7200.74, 8101.49, 9002.23, 11024.78, 12244.91, 13831.57, 14855.95,
                        15660.32, 16990.45, 18295.70, 19306.44, 19987.18, 20997.93, 21788.67, 25998.97, 26798.97,
                        28495.64, 33273.34, 35542.55, 36872.68, 37672.68, 38692.68, 40107.92, 41008.67, 43127.63,
                        45044.30, 46288.68, 47398.80, 48088.80, 48888.80, 50365.47, 51389.85, 53443.19, 54343.93,
                        56476.48, 57610.85, 59884.20, 60674.94, 63027.49, 65300.83, 66311.57, 68444.12, 69578.50,
                        71851.84, 72642.58, 74775.13, 76828.47, 79181.02, 80315.40, 81449.77, 82669.90, 83469.90,
                        84665.14, 86784.11, 88370.78, 89700.91, 91226.15, 93345.12, 94650.36, 96769.33, 97964.57,
                        98865.32, 99876.06, 100886.80, 101787.55, 102908.29, 105027.26, 106332.50, 108451.47, 109251.47,
                        111058.13, 111972.51, 113106.88, 115380.23, 116280.97, 117071.71, 118082.45, 120201.42,
                        121001.42, 122416.67, 124769.22, 126932.56, 129161.52, 130968.19, 131772.57, 134045.91,
                        134836.65, 135737.39, 137746.36, 138941.60, 141294.15, 142428.53, 143342.90, 145506.24,
                        147858.79, 150132.14, 152154.69, 153289.06, 155562.40, 156463.14, 158582.11, 159382.11,
                        160182.11, 160982.11, 162898.78, 163923.15, 169873.34, 170774.08, 178832.55, 179942.68,
                        181247.92, 183518.97, 184934.21, 187053.18, 187998.39, 190106.67, 191021.04, 192045.42,
                        200663.34, 202672.31, 203867.55, 206300.74, 209432.55, 210456.93, 211481.30, 213864.64,
                        219518.97, 221325.64, 223598.98, 224499.72, 226632.27, 227766.64, 228986.77, 229896.77,
                        231703.44, 233976.78, 236095.75, 237510.99, 239753.54, 242026.88, 244269.43, 245293.81,
                        246318.18, 248811.52, 250930.49, 252737.16, 253957.29, 255543.95, 256764.08, 258179.33,
                        258970.07, 261322.62, 263485.96, 265618.51, 266422.89, 267337.26, 269610.60, 270511.34,
                        271910.74, 272921.49, 273712.23, 274612.97, 275403.71, 284280.74, 287952.55, 291024.38,
                        292014.38, 293344.50, 295041.17, 296261.30, 297957.97, 299068.10, 300654.76, 301764.89,
                        303351.56, 304485.93, 305706.06, 307011.31, 308022.05, 310251.02, 311947.68, 312862.06,
                        314082.19, 314992.19, 316297.43, 318539.98, 319564.36, 320698.73, 321723.11, 322637.48,
                        323747.61, 325052.85, 325953.60, 326854.34, 328973.31, 330058.55, 0.],
                       rtol=1e-4, atol=1e-5)
    assert np.allclose(erm.L,
                       [0.00, 3100.00, 4515.24, 6300.00, 7200.74, 8101.49, 9002.23, 11024.78, 12244.91, 13831.57,
                        14855.95, 15660.32, 16990.45, 18295.70, 19306.44, 19987.18, 20997.93, 24100.00, 25998.97,
                        26798.97, 31000.00, 33300.00, 35542.55, 36872.68, 37672.68, 38692.68, 40107.92, 41008.67,
                        43127.63, 45044.30, 46288.68, 47398.80, 48088.80, 48888.80, 50365.47, 51389.85, 53443.19,
                        54343.93, 56476.48, 57610.85, 59884.20, 60674.94, 63027.49, 65300.83, 66311.57, 68444.12,
                        69578.50, 71851.84, 72642.58, 74775.13, 76828.47, 79181.02, 80315.40, 81449.77, 82669.90,
                        83469.90, 84665.14, 86784.11, 88370.78, 89700.91, 91226.15, 93345.12, 94650.36, 96769.33,
                        97964.57, 98865.32, 99876.06, 100886.80, 101787.55, 102908.29, 105027.26, 106332.50, 108451.47,
                        109251.47, 111058.13, 111972.51, 113106.88, 115380.23, 116280.97, 117071.71, 118082.45,
                        120201.42, 121001.42, 122416.67, 124769.22, 126932.56, 129161.52, 130968.19, 131772.57,
                        134045.91, 134836.65, 135737.39, 137746.36, 138941.60, 141294.15, 142428.53, 143342.90,
                        145506.24, 147858.79, 150132.14, 152154.69, 153289.06, 155562.40, 156463.14, 158582.11,
                        159382.11, 160182.11, 160982.11, 162898.78, 167600.00, 169873.34, 176700.00, 178832.55,
                        179942.68, 181400.00, 183518.97, 184934.21, 187200.00, 188300.00, 190106.67, 191021.04,
                        198500.00, 200663.34, 202672.31, 205400.00, 207300.00, 209432.55, 210456.93, 211481.30,
                        217400.00, 219518.97, 221325.64, 223598.98, 224499.72, 226632.27, 227766.64, 228986.77,
                        229896.77, 231703.44, 233976.78, 236095.75, 237510.99, 239753.54, 242026.88, 244269.43,
                        245293.81, 246318.18, 248811.52, 250930.49, 252737.16, 253957.29, 255543.95, 256764.08,
                        258179.33, 258970.07, 261322.62, 263485.96, 265618.51, 266422.89, 267337.26, 269610.60,
                        270900.00, 271910.74, 272921.49, 273712.23, 274612.97, 283600.00, 285600.00, 290000.00,
                        291100.00, 292014.38, 293344.50, 295041.17, 296261.30, 297957.97, 299068.10, 300654.76,
                        301764.89, 303351.56, 304485.93, 305706.06, 307011.31, 308022.05, 310251.02, 311947.68,
                        312862.06, 314082.19, 314992.19, 316297.43, 318539.98, 319564.36, 320698.73, 321723.11,
                        322637.48, 323747.61, 325052.85, 325953.60, 326854.34, 328973.31, 330058.55],
                       rtol=1e-4, atol=1e-5)
    assert np.allclose(erm.S,
                       [0.00, 4740.47, 5751.22, 7535.97, 8436.72, 9337.46, 11172.78, 12355.31, 13869.57, 14783.95,
                        15808.32, 16990.85, 18630.93, 19531.67, 20542.41, 21223.16, 22233.90, 26329.37, 26907.75,
                        28423.64, 33608.57, 35470.55, 36873.08, 37781.47, 38581.47, 40333.15, 41343.90, 43238.03,
                        44752.30, 45996.68, 47619.20, 48307.59, 48997.59, 50513.47, 51317.85, 53998.42, 54679.16,
                        56514.48, 57428.85, 60219.43, 61120.17, 62845.49, 65636.06, 66536.80, 68482.12, 69396.50,
                        72187.07, 73087.81, 74813.13, 77383.70, 78999.02, 80133.40, 81267.77, 82780.30, 83578.69,
                        85110.37, 86894.51, 88408.78, 89701.31, 91341.38, 93455.52, 94985.59, 96879.73, 98409.80,
                        99200.55, 100101.29, 101112.03, 102122.78, 103023.52, 105137.66, 106667.73, 108561.87,
                        109360.25, 110876.13, 112010.51, 112924.88, 115715.46, 116616.20, 117516.94, 118307.68,
                        120311.82, 121110.21, 122641.90, 124587.22, 127377.79, 129161.92, 130786.19, 131920.57,
                        134381.14, 135281.88, 136072.62, 137966.76, 139386.83, 141112.15, 142246.53, 143380.90,
                        145951.48, 147676.79, 150467.37, 152302.69, 153107.06, 155897.63, 156798.37, 158692.51,
                        159490.90, 160290.90, 161090.90, 162606.78, 163851.15, 170208.57, 171109.31, 178870.55,
                        180163.08, 181583.15, 183629.37, 185159.44, 187163.58, 188108.79, 189924.67, 191059.04,
                        191973.42, 201108.57, 202892.71, 204312.78, 206635.97, 209470.55, 210384.93, 211409.30,
                        214089.87, 219629.37, 221143.64, 223934.21, 224834.95, 226670.27, 227584.64, 229097.17,
                        229895.56, 231521.44, 234312.01, 236206.15, 237736.22, 239681.54, 242362.11, 244197.43,
                        245221.81, 246246.18, 248926.75, 251040.89, 252555.16, 254067.69, 255581.95, 256874.48,
                        258404.56, 259415.30, 261140.62, 263931.19, 265656.51, 266570.89, 267375.26, 269945.83,
                        270846.57, 272135.97, 273146.72, 274157.46, 274948.20, 275848.95, 284835.97, 287770.55,
                        290952.38, 292052.38, 293344.90, 294969.17, 296371.70, 297885.97, 299288.50, 300692.76,
                        301985.29, 303389.56, 304303.93, 305816.46, 307346.54, 308247.28, 310251.42, 311875.68,
                        312900.06, 314192.59, 314990.97, 316632.66, 318467.98, 319492.36, 320516.73, 321651.11,
                        322675.48, 323968.01, 325388.09, 326288.83, 327189.57, 329083.71, 330613.78, 331294.53],
                       rtol=1e-4, atol=1e-5)
    assert np.allclose(erm.C,
                       [1923.00, 6773.47, 7674.22, 9458.97, 10359.72, 11260.46, 13045.78, 14278.31, 15852.57, 16876.95,
                        17681.32, 19023.85, 20553.93, 21564.67, 22245.41, 23256.16, 24046.90, 28032.37, 28832.37,
                        30516.64, 35531.57, 37563.55, 38906.08, 39706.08, 40726.08, 42366.15, 43266.90, 45161.03,
                        47065.30, 48309.68, 49432.20, 50122.20, 50922.20, 52386.47, 53410.85, 55701.42, 56602.16,
                        58497.48, 59631.85, 62142.43, 62933.17, 65048.49, 67559.06, 68569.80, 70465.12, 71599.50,
                        74110.07, 74900.81, 76796.13, 79086.70, 81202.02, 82336.40, 83470.77, 84703.30, 85503.30,
                        86923.37, 88817.51, 90391.78, 91734.31, 93484.38, 95378.52, 96908.59, 98802.73, 100222.80,
                        101123.55, 102134.29, 103145.03, 104045.78, 105166.52, 107060.66, 108590.73, 110484.87,
                        111284.87, 113079.13, 113993.51, 115127.88, 117638.46, 118539.20, 119329.94, 120340.68,
                        122234.82, 123034.82, 124674.90, 126790.22, 129190.79, 131194.92, 132989.19, 133793.57,
                        136304.14, 137094.88, 137995.62, 139779.76, 141199.83, 143315.15, 144449.53, 145363.90,
                        147764.48, 149879.79, 152390.37, 154175.69, 155310.06, 157820.63, 158721.37, 160615.51,
                        161415.51, 162215.51, 163015.51, 164919.78, 165944.15, 172131.57, 173032.31, 180853.55,
                        181976.08, 183506.15, 185552.37, 187192.44, 189086.58, 190031.79, 192127.67, 193042.04,
                        194066.42, 202921.57, 204705.71, 206125.78, 208558.97, 211453.55, 212477.93, 213502.30,
                        216122.87, 221552.37, 223346.64, 225857.21, 226757.95, 228653.27, 229787.64, 231020.17,
                        231930.17, 233724.44, 236235.01, 238129.15, 239769.22, 241774.54, 244285.11, 246290.43,
                        247314.81, 248339.18, 251069.75, 252963.89, 254758.16, 255990.69, 257564.95, 258797.48,
                        260437.56, 261228.30, 263343.62, 265744.19, 267639.51, 268443.89, 269358.26, 271868.83,
                        272769.57, 274168.97, 275179.72, 275970.46, 276871.20, 277661.95, 286538.97, 289973.55,
                        293045.38, 294035.38, 295377.90, 297062.17, 298294.70, 299978.97, 301101.50, 302675.76,
                        303798.29, 305372.56, 306506.93, 307739.46, 309269.54, 310280.28, 312284.42, 313968.68,
                        314883.06, 316115.59, 317025.59, 318555.66, 320560.98, 321585.36, 322719.73, 323744.11,
                        324658.48, 325781.01, 327311.09, 328211.83, 329112.57, 331006.71, 332316.78, 333327.53],
                       rtol=1e-4, atol=1e-5)
    assert np.allclose(erm.Vm,
                       [-110.40, 4515.24, 5415.99, 7200.74, 8101.49, 9002.23, 11024.78, 12244.91, 13831.57, 14855.95,
                        15660.32, 16990.45, 18295.70, 19306.44, 19987.18, 20997.93, 21788.67, 25998.97, 26798.97,
                        28495.64, 33273.34, 35542.55, 36872.68, 37672.68, 38692.68, 40107.92, 41008.67, 43127.63,
                        45044.30, 46288.68, 47398.80, 48088.80, 48888.80, 50365.47, 51389.85, 53443.19, 54343.93,
                        56476.48, 57610.85, 59884.20, 60674.94, 63027.49, 65300.83, 66311.57, 68444.12, 69578.50,
                        71851.84, 72642.58, 74775.13, 76828.47, 79181.02, 80315.40, 81449.77, 82669.90, 83469.90,
                        84665.14, 86784.11, 88370.78, 89700.91, 91226.15, 93345.12, 94650.36, 96769.33, 97964.57,
                        98865.32, 99876.06, 100886.80, 101787.55, 102908.29, 105027.26, 106332.50, 108451.47, 109251.47,
                        111058.13, 111972.51, 113106.88, 115380.23, 116280.97, 117071.71, 118082.45, 120201.42,
                        121001.42, 122416.67, 124769.22, 126932.56, 129161.52, 130968.19, 131772.57, 134045.91,
                        134836.65, 135737.39, 137746.36, 138941.60, 141294.15, 142428.53, 143342.90, 145506.24,
                        147858.79, 150132.14, 152154.69, 153289.06, 155562.40, 156463.14, 158582.11, 159382.11,
                        160182.11, 160982.11, 162898.78, 163923.15, 169873.34, 170774.08, 178832.55, 179942.68,
                        181247.92, 183518.97, 184934.21, 187053.18, 187998.39, 190106.67, 191021.04, 192045.42,
                        200663.34, 202672.31, 203867.55, 206300.74, 209432.55, 210456.93, 211481.30, 213864.64,
                        219518.97, 221325.64, 223598.98, 224499.72, 226632.27, 227766.64, 228986.77, 229896.77,
                        231703.44, 233976.78, 236095.75, 237510.99, 239753.54, 242026.88, 244269.43, 245293.81,
                        246318.18, 248811.52, 250930.49, 252737.16, 253957.29, 255543.95, 256764.08, 258179.33,
                        258970.07, 261322.62, 263485.96, 265618.51, 266422.89, 267337.26, 269610.60, 270511.34,
                        271910.74, 272921.49, 273712.23, 274612.97, 275403.71, 284280.74, 287952.55, 291024.38,
                        292014.38, 293344.50, 295041.17, 296261.30, 297957.97, 299068.10, 300654.76, 301764.89,
                        303351.56, 304485.93, 305706.06, 307011.31, 308022.05, 310251.02, 311947.68, 312862.06,
                        314082.19, 314992.19, 316297.43, 318539.98, 319564.36, 320698.73, 321723.11, 322637.48,
                        323747.61, 325052.85, 325953.60, 326854.34, 328973.31, 330058.55, 331069.29],
                       rtol=1e-4, atol=1e-5)
    assert np.allclose(erm.Vp,
                       [-110.40, 4515.24, 5415.99, 7200.74, 8101.49, 9002.23, 11024.78, 12244.91, 13831.57, 14855.95,
                        15660.32, 16990.45, 18295.70, 19306.44, 19987.18, 20997.93, 21788.67, 25998.97, 26798.97,
                        28495.64, 33273.34, 35542.55, 36872.68, 37672.68, 38692.68, 40107.92, 41008.67, 43127.63,
                        45044.30, 46288.68, 47398.80, 48088.80, 48888.80, 50365.47, 51389.85, 53443.19, 54343.93,
                        56476.48, 57610.85, 59884.20, 60674.94, 63027.49, 65300.83, 66311.57, 68444.12, 69578.50,
                        71851.84, 72642.58, 74775.13, 76828.47, 79181.02, 80315.40, 81449.77, 82669.90, 83469.90,
                        84665.14, 86784.11, 88370.78, 89700.91, 91226.15, 93345.12, 94650.36, 96769.33, 97964.57,
                        98865.32, 99876.06, 100886.80, 101787.55, 102908.29, 105027.26, 106332.50, 108451.47, 109251.47,
                        111058.13, 111972.51, 113106.88, 115380.23, 116280.97, 117071.71, 118082.45, 120201.42,
                        121001.42, 122416.67, 124769.22, 126932.56, 129161.52, 130968.19, 131772.57, 134045.91,
                        134836.65, 135737.39, 137746.36, 138941.60, 141294.15, 142428.53, 143342.90, 145506.24,
                        147858.79, 150132.14, 152154.69, 153289.06, 155562.40, 156463.14, 158582.11, 159382.11,
                        160182.11, 160982.11, 162898.78, 163923.15, 169873.34, 170774.08, 178832.55, 179942.68,
                        181247.92, 183518.97, 184934.21, 187053.18, 187998.39, 190106.67, 191021.04, 192045.42,
                        200663.34, 202672.31, 203867.55, 206300.74, 209432.55, 210456.93, 211481.30, 213864.64,
                        219518.97, 221325.64, 223598.98, 224499.72, 226632.27, 227766.64, 228986.77, 229896.77,
                        231703.44, 233976.78, 236095.75, 237510.99, 239753.54, 242026.88, 244269.43, 245293.81,
                        246318.18, 248811.52, 250930.49, 252737.16, 253957.29, 255543.95, 256764.08, 258179.33,
                        258970.07, 261322.62, 263485.96, 265618.51, 266422.89, 267337.26, 269610.60, 270511.34,
                        271910.74, 272921.49, 273712.23, 274612.97, 275403.71, 284280.74, 287952.55, 291024.38,
                        292014.38, 293344.50, 295041.17, 296261.30, 297957.97, 299068.10, 300654.76, 301764.89,
                        303351.56, 304485.93, 305706.06, 307011.31, 308022.05, 310251.02, 311947.68, 312862.06,
                        314082.19, 314992.19, 316297.43, 318539.98, 319564.36, 320698.73, 321723.11, 322637.48,
                        323747.61, 325052.85, 325953.60, 326854.34, 328973.31, 330058.55, 331069.29],
                       rtol=1e-4, atol=1e-5)

    # CT, LRT, TT
    assert np.allclose(erm.CT,
                       [1923.00, 3673.47, 4074.22, 3158.97, 4059.72, 4760.46, 6245.78, 7378.31, 8352.57, 8276.95,
                        4681.32, 5123.85, 6053.93, 4764.67, 5145.41, 5956.16, 4146.90, 3932.37, 3732.37, 5316.64,
                        4531.57, 4263.55, 5306.08, 5806.08, 3726.08, 5266.15, 5666.90, 7061.03, 7165.30, 7609.68,
                        5132.20, 5722.20, 5822.20, 5886.47, 6710.85, 7901.42, 7402.16, 7697.48, 8131.85, 10642.43,
                        11133.17, 12648.49, 14359.06, 14869.80, 16465.12, 16799.50, 16510.07, 16800.81, 15296.13,
                        9686.70, 10602.02, 11036.40, 9270.77, 10203.30, 10903.30, 11323.37, 13117.51, 13991.78,
                        11734.31, 11884.38, 12878.52, 14408.59, 16002.73, 16322.80, 16123.55, 15334.29, 15745.03,
                        16645.78, 17666.52, 17760.66, 18790.73, 18784.87, 18784.87, 20179.13, 19293.51, 20127.88,
                        20838.46, 19739.20, 19729.94, 18540.68, 15534.82, 15134.82, 13574.90, 14290.22, 15390.79,
                        17194.92, 17989.19, 18593.57, 20804.14, 19494.88, 13495.62, 13979.76, 14599.83, 16215.15,
                        16949.53, 13563.90, 13964.48, 14179.79, 16090.37, 16675.69, 14310.06, 16820.63, 13321.37,
                        13315.51, 12715.51, 12715.51, 12315.51, 11919.78, 4844.15, 4531.57, 3332.31, 4153.55, 5076.08,
                        4906.15, 4152.37, 5592.44, 4686.58, 2831.79, 3827.67, 4642.04, 5666.42, 4421.57, 4305.71,
                        5325.78, 3158.97, 4153.55, 3277.92, 3402.30, 5022.87, 4152.37, 5546.64, 8057.21, 8757.95,
                        9553.27, 9787.64, 10420.17, 10230.17, 3924.44, 5835.01, 6329.15, 7969.22, 9574.54, 11485.11,
                        9590.43, 10214.81, 9739.18, 9969.75, 11363.89, 11058.16, 11090.69, 11964.95, 10997.48, 10737.56,
                        10428.30, 8443.62, 10044.19, 7139.51, 7843.89, 5058.26, 4968.83, 4269.57, 3268.97, 4179.72,
                        4870.46, 3971.20, 3061.95, 2938.97, 4373.55, 3045.38, 2935.38, 3677.90, 4662.17, 5494.70,
                        5178.97, 4701.50, 4975.76, 5498.29, 6672.56, 4806.93, 5839.46, 6969.54, 7180.28, 6684.42,
                        7768.68, 7283.06, 8115.59, 4925.59, 6255.66, 7560.98, 5685.36, 6419.73, 7044.11, 7158.48,
                        7481.01, 5811.09, 6011.83, 6112.57, 5506.71, 4216.78, 4927.53], rtol=1e-4, atol=1e-5)
    assert np.allclose(erm.LRT,
                       [1923, 2033, 1923, 1923, 1923, 1923, 1873, 1923, 1983, 2093, 1873, 2033, 1923, 2033, 1703, 2033,
                        1813, 1703, 1924.614286, 2093, 1923, 2093, 2033, 1924.614286, 2144.614286, 2033, 1923, 1923,
                        2313, 2313, 1813, 1814.614286, 1924.614286, 1873, 2093, 1703, 1923, 1983, 2203, 1923, 1813,
                        2203, 1923, 2033, 1983, 2203, 1923, 1813, 1983, 1703, 2203, 2203, 2203, 1923, 1924.614286, 1813,
                        1923, 1983, 2033, 2143, 1923, 1923, 1923, 1813, 1923, 2033, 2033, 1923, 2143, 1923, 1923, 1923,
                        1924.614286, 2203, 1983, 2203, 1923, 1923, 1813, 2033, 1923, 1924.614286, 2033, 2203, 1813,
                        2033, 2203, 1873, 1923, 1813, 1923, 1813, 1813, 2203, 2203, 1983, 1813, 2203, 1923, 1873, 2203,
                        1923, 1923, 1923, 1924.614286, 1924.614286, 1924.614286, 2313, 2093, 1923, 1923, 1983, 1813,
                        1923, 1923, 2033, 1923, 1923, 2203, 1983, 2093, 1813, 1813, 1813, 1923, 1983, 2093, 2093, 2033,
                        1923, 2203, 1923, 1923, 1983, 2203, 1923, 2034.614286, 2203, 1923, 1923, 2033, 2093, 1923, 2093,
                        2093, 2093, 2143, 1923, 2203, 1923, 1983, 1923, 2033, 1813, 2203, 1813, 1983, 1873, 1983, 1923,
                        1923, 2033, 2033, 1813, 1923, 1813, 1703, 2203, 2093, 1983, 2033, 2093, 1923, 2093, 1813, 1983,
                        1813, 1983, 2203, 1923, 1923, 2033, 2033, 2093, 1983, 1923, 2034.614286, 1923, 2093, 2093, 2203,
                        2093, 1983, 1813, 1923, 1923, 1923, 1923, 1703, 2033], rtol=1e-4, atol=1e-5)
    assert np.allclose(erm.TT,
                       [1923.00, 2033.00, 900.74, 1784.76, 900.74, 900.74, 1785.32, 1232.53, 1574.27, 1024.38, 804.38,
                        1342.53, 1530.07, 1010.74, 680.74, 1010.74, 790.74, 1703.00, 800.00, 1684.27, 1923.00, 2031.98,
                        1342.53, 800.00, 1020.00, 1640.07, 900.74, 1894.14, 1904.27, 1244.38, 1122.53, 690.00, 800.00,
                        1464.27, 1024.38, 1703.00, 900.74, 1895.32, 1134.38, 1923.00, 790.74, 2115.32, 1923.00, 1010.74,
                        1895.32, 1134.38, 1923.00, 790.74, 1895.32, 1703.00, 2115.32, 1134.38, 1134.38, 1232.53, 800.00,
                        1420.07, 1894.14, 1574.27, 1342.53, 1750.07, 1894.14, 1530.07, 1894.14, 1420.07, 900.74,
                        1010.74, 1010.74, 900.74, 1120.74, 1894.14, 1530.07, 1894.14, 800.00, 1794.27, 914.38, 1134.38,
                        1923.00, 900.74, 790.74, 1010.74, 1894.14, 800.00, 1640.07, 2115.32, 1813.00, 2004.14, 1794.27,
                        804.38, 1923.00, 790.74, 900.74, 1784.14, 1420.07, 2115.32, 1134.38, 914.38, 1813.00, 2115.32,
                        1923.00, 1785.32, 1134.38, 1923.00, 900.74, 1894.14, 800.00, 800.00, 800.00, 1904.27, 1024.38,
                        1923.00, 900.74, 1983.00, 1122.53, 1530.07, 1923.00, 1640.07, 1894.14, 945.21, 2095.88, 914.38,
                        1024.38, 1813.00, 1784.14, 1420.07, 1923.00, 1983.00, 1024.38, 1024.38, 2033.00, 1923.00,
                        1794.27, 1923.00, 900.74, 1895.32, 1134.38, 1232.53, 910.00, 1794.27, 1923.00, 1894.14, 1640.07,
                        2005.32, 1923.00, 2005.32, 1024.38, 1024.38, 2143.00, 1894.14, 1794.27, 1232.53, 1574.27,
                        1232.53, 1640.07, 790.74, 2115.32, 1813.00, 1895.32, 804.38, 914.38, 1923.00, 900.74, 1399.40,
                        1010.74, 790.74, 900.74, 790.74, 1703.00, 2203.00, 2093.00, 990.00, 1342.53, 1684.27, 1232.53,
                        1684.27, 1122.53, 1574.27, 1122.53, 1574.27, 1134.38, 1232.53, 1530.07, 1010.74, 2004.14,
                        1684.27, 914.38, 1232.53, 910.00, 1530.07, 2005.32, 1024.38, 1134.38, 1024.38, 914.38, 1122.53,
                        1530.07, 900.74, 900.74, 1894.14, 1310.07, 1010.74], rtol=1e-4, atol=1e-5)

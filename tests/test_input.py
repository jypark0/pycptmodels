import random

import numpy as np

from pycptmodels.input import PoissonProcessInput


def test_initialize():
    seed = 123
    np.random.seed(seed)
    random.seed(seed)

    input1 = PoissonProcessInput(N=20, lambda_=1000, lotsizes=[3, 4, 5, 6, 7],
                                 lotsize_weights=[0.05, 0.2, 0.5, 0.2, 0.05], reticle=[210, 260], prescan=[240, 420],
                                 K=3)
    input1.initialize()

    assert np.allclose(input1.A, [0.0, 1192.2721434811056, 1529.3396261566365, 1786.6237062736873, 2588.057388088375,
                                  3859.1283235758174, 4409.225859354794, 8360.207928169511, 9514.850201921237,
                                  10170.570395332106, 10668.344097533856, 11088.686347791254, 12394.506244798911,
                                  12971.77842160194, 13033.311220834337, 13540.882571047854, 14880.275811048727,
                                  15081.770071657407, 15274.689697492384, 16033.018536821166])
    assert np.array_equal(input1.W, [4, 4, 5, 4, 6, 3, 5, 5, 6, 4, 5, 5, 4, 3, 5, 4, 5, 4, 5, 5])
    assert np.array_equal(input1.lotclass, [0, 0, 1, 0, 1, 0, 0, 0, 2, 1, 1, 2, 2, 2, 1, 0, 0, 2, 1, 0])
    assert np.allclose(input1.tau_R, [211.39909775214744, 218.69532581183503, 217.70411209234234, 213.85432403991416,
                                      254.49328498033856, 247.5189352383424, 244.67016218012571, 235.5881687633085,
                                      233.2134027868334, 238.42153464094488, 225.12747269767726, 234.8654393161931,
                                      244.16314567115498, 255.8349336871711, 215.44644761198546, 234.7745893841832,
                                      221.64179649929892, 231.84303313974087, 247.57714968943174, 234.0446063974279])
    assert np.allclose(input1.tau_S,
                       [383.5911136012586, 290.8865281798857, 318.0152830608002, 241.75632294074998, 301.343276761949,
                        364.0689611631195, 396.48647217141263, 288.2046879222693, 322.21462503430604,
                        288.29063538811045, 390.6695034539896, 288.6926396298709, 335.41116201595696, 271.5670789403848,
                        296.6939602603235, 400.3996372510489, 272.46053095877267, 328.9769163954426, 278.21365861019683,
                        333.7578363668831])
